# 提议者-构建者分离（PBS）

在当前的以太坊系统中，验证者（Validators）既负责创建区块，也负责广播区块。他们通过 P2P 网络发现交易，并将其打包进区块，然后广播给网络中的其他节点。

**提议者-构建者分离（Proposer-Builder Separation, PBS）** 将这些任务拆分给不同的验证者。区块构建者（Block Builders）负责创建区块，并将其提供给每个时隙（Slot）的区块提议者（Block Proposer）。区块提议者无法查看区块的具体内容，他们只会选择最有利可图的区块，并向区块构建者支付费用，然后再将区块广播给网络中的其他节点。

本文将详细介绍 PBS，包括区块提议者和区块构建者的角色、当前状态（MEV-Boost、Relays）、挑战与安全问题，以及相关的研究和解决方案。

## PBS 重要性

PBS 对以太坊的去中心化至关重要，因为它减少了成为验证者所需的计算资源，从而降低了准入门槛，使更多多样化的参与者能够加入网络。此外，PBS 体现了以太坊合并（The Merge）后向模块化架构发展的目标，进一步促进去中心化。

将区块构建的不同部分拆分后，可以分别去中心化不同的角色。这允许具备不同专业技能的参与者专注于自己的强项，从而提高网络的整体能力，减少外部依赖，并降低参与门槛。

## PBS 与共识层

根据这篇[文章](https://ethos.dev/beacon-chain)，时隙（Slot）是共识层中用于添加区块的时间框架，每个时隙持续 12 秒，每 32 个时隙构成一个 Epoch（纪元）。Epoch 在共识机制中至关重要，它用于区块最终确定（Finality）、更新验证者委员会等。对于每个时隙，会通过 [RANDAO](https://inevitableeth.com/home/ethereum/network/consensus/randao) 随机选择一个验证者来提议区块。一旦区块被提议并添加到主链，验证者委员会将对其进行验证并最终确定。

PBS 通过将区块提议和区块构建的职责分离，使交易验证流程更加高效。

### 区块构建者的角色

**区块构建者（Block Builders）** 负责收集、验证交易并将其组装成区块体（Block Body）。他们需要：

- 检索交易池中的交易；
- 验证交易是否符合 Gas 费、Nonce 等规则；
- 设计区块数据结构；
- 以最优顺序排列交易，以优化区块空间和 Gas 费用；
- 将构建好的区块体提供给区块提议者。

### 区块提议者的角色

**区块提议者（Block Proposers）** 负责选择并最终提交区块，他们需要：

- 从区块构建者那里接收区块体；
- 生成包含必要元数据的完整区块，如区块头（Header），其中包括父区块哈希、时间戳等信息；
- 确保区块的正确性并向网络广播。

## 当前 PBS 状态

目前，PBS 并未在以太坊主网原生支持，而是依赖于外部协议，如 MEV-Boost。这种设计依赖于少数受信任的 Relays 和 Builders，带来了中心化风险，并可能导致审查问题。

目前的验证者仍需自行完成以下任务：

1. **选择交易**：基于 Gas 费和交易优先级选择交易；
2. **构建区块**：将交易打包进区块，并执行签名验证、状态更新等操作；
3. **提议区块**：向网络广播区块，等待共识确认。

然而，一些客户端正在积极开发和测试 PBS 实现，目标是分离构建者与提议者的角色，使验证者能够将区块构建外包给专业构建者。这种方式带来的潜在好处包括：

- **提高验证者奖励**：构建者之间竞争生成最优区块，可能提升验证者收益；
- **提升网络效率**：专业构建者优化区块构建，提高区块传播和处理效率；
- **减少中心化风险**：角色拆分后，可降低大型矿池或质押服务商对区块提议的影响。

### PBS 相关角色与关系

1. **搜索者（Searchers）**：
   - 搜索者从交易池中寻找 MEV（最大可提取价值）机会，例如抢跑（Frontrunning）、三明治攻击（Sandwich）、套利（Arbitrage）；
   - 他们构建包含 MEV 策略的交易包，并向区块构建者提交交易；
2. **区块构建者（Builders）**：
   - 负责创建最优区块，并向提议者提交报价；
3. **中继器（Relays）**：
   - 负责在构建者与提议者之间中介，验证区块有效性，并选择最高报价的区块提交给验证者；
4. **验证者（Proposers）**：
   - 作为区块提议者，选择最高收益的区块进行提议。

## PBS 研究与提案

### **原生 PBS（ePBS）**

[原生 PBS 研究](https://ethresear.ch/t/why-enshrine-proposer-builder-separation-a-viable-path-to-epbs/15710)提出，将 PBS 机制嵌入以太坊共识层，以减少中心化风险和提高安全性。

- **减少中心化风险**：减少对外部 Relays 依赖；
- **提高安全性**：降低协调成本，增强协议稳定性。

### **协议强制提议者承诺（PEPC）**

[PEPC 方案](https://mirror.xyz/ohotties.eth/lBEXiiU7yK91OuSn8QyJPM9Db8GuyDFzCEUAj60BWyI)旨在提供更通用的基础设施，让提议者做出可信承诺。

- **增强信任**：提议者可注册任意承诺，区块构建者需满足该承诺才能提交区块；
- **降低外部依赖**：集成在协议内，确保区块提议符合既定承诺。

### **EIP-7547：包含列表（Inclusion Lists）**

[EIP-7547](https://ethereum-magicians.org/t/eip-7547-inclusion-lists/17474) 旨在提高以太坊的抗审查能力。

- **强制包含交易**：提议者可指定必须包含的交易；
- **平衡 MEV 收益与抗审查**：降低中心化构建者的影响力。

## 进一步阅读

- [Proposer-Builder Separation (PBS) 研究](https://barnabe.substack.com/p/pbs)
- [MEV 提取的时间游戏及影响](https://chorus.one/articles/timing-games-and-implications-on-mev-extraction)
- [Vitalik Buterin 论文：PBS 及审查抵抗](https://notes.ethereum.org/@vbuterin/pbs_censorship_resistance)

