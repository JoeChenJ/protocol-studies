# Two-Block HeadLock (TBHL) 提案用于 ePBS

Two-Block HeadLock (TBHL) 设计代表了以太坊协议中[提议者-构建者分离（PBS）](https://docs/wiki/research/PBS/pbs.md)的一种创新方法，旨在解决由 MEV 引发的操作性和[战略性问题](https://ethresear.ch/t/why-enshrine-proposer-builder-separation-a-viable-path-to-epbs/)。这一设计是对之前提案的细致迭代，融合了 Vitalik Buterin 的两轮设计，并通过引入 headlock 机制增强保护，防止提议者的矛盾行为。本文将深入探讨 TBHL 的关键组件及其操作机制，结合[^1]中的详细解释。

## TBHL 设计概述

TBHL 修改了以太坊传统的时隙结构，在一个时隙时间框架内引入了双区块系统，有效地生成了提议者区块和构建者区块。该系统保留了每个时隙一个执行负载的核心内容，尽管增加了一个额外的确认回合，可能会延长时隙的持续时间。TBHL 与以太坊现有的 LMD-GHOST 机制高度兼容，并遵循六个指定的设计属性，确保与以太坊生态系统的兼容性和完整性。

## 时隙结构与操作阶段

![TBHL 的时隙结构](../img/scaling/Slot-Anatomy-of-TBHL-Mike.png)

_图 — TBHL 的时隙结构。由 Mike Neuder 和 Justin Drake 提供。_

TBHL 的操作框架围绕时隙中的四个关键时间戳展开，为提议者、构建者和验证者指定了具体的操作时间：

1. **t=t0 - 提议获胜出价：** 提议者开始评估出价池中的出价，这是一个点对点（P2P）话题，构建者在此提交他们的出价。提议者选择出价后，发布提议者区块，然后进入下一个阶段。

2. **t=t1 - 提议者区块的确认截止时间：** 在这一阶段，确认委员会评估提议者区块的及时性。委员会投票支持首次观察到的区块，若没有，则投票支持空时隙。

3. **t=t1.5 - 矛盾行为检查：** 在此阶段，验证委员会检查提议者区块是否存在矛盾行为。若发现唯一的提议者区块，则为相关构建者提供奖励，增强过程的公平性和完整性。

4. **t=t2 - 构建者验证与区块发布：** 构建者验证自己是否为唯一获胜者。若存在矛盾行为，构建者可生成包含证据的区块以撤销支付，否则，继续发布构建者区块，内容为交易信息。

5. **t=t3 - 第二次确认截止时间：** 此阶段为构建者区块进行再次确认，巩固其在区块链中的位置。

## 满足 ePBS 设计属性

TBHL 有效解决了多个关键的 ePBS 设计属性：

- **诚实构建者发布与支付安全：** 保护机制确保构建者可以自信地发布区块，防止提议者的矛盾行为。

- **诚实提议者安全：** 诚实提议者的承诺得到尊重，提议者的区块会获得必要的确认，且支付会无条件进行，除非有矛盾行为证据。

- **无许可性与抗审查性：** 该设计促进了构建者的开放竞争环境，并保持了抗审查的措施。

- **路线图兼容性：** TBHL 设计与以太坊的路线图兼容，包括单时隙最终性（SSF）和 MEV 烧毁机制，展现了其在未来网络需求上的适应性和前瞻性。

## 实施 TBHL 的工程挑战

实施 TBHL 提案引入了多个复杂的挑战和工程问题，反映了以太坊共识机制、动态的 MEV 领域以及协议整体设计理念之间的复杂互动。根据 ePBS 讨论中的详细探讨，以下是与 TBHL 相关的主要实施问题和工程难题：

- **协议复杂性增加** TBHL 通过在单一时隙内引入双区块机制，显著改变了传统的时隙结构，增加了共识过程的复杂性。这种复杂性来自于管理两种不同类型的区块（提议者区块和构建者区块），并需要额外的确认回合来验证每个区块。此外，检测和管理提议者区块的矛盾行为也增加了复杂度，需要强大的机制来确保构建者安全和支付安全。

- **时隙时间与网络延迟** 实施 TBHL 需要仔细考虑时隙的时间安排，因为额外的确认回合可能会延长时隙的持续时间。这一调整可能会影响网络延迟，从而影响区块传播和确认聚合的及时性。确保网络能够高效地处理这些过程，而不引入显著的延迟或漏洞，是一项巨大的工程挑战。此外，时隙持续时间的变化是以太坊合并后的一项重大工程项目，因为它涉及对 CL、EL 以及其他智能合约层的更改。

- **矛盾行为与构建者安全机制** TBHL 的关键组件之一是管理提议者矛盾行为以保护构建者。设计和实现强大的机制来检测矛盾行为，允许构建者提供相关证据，并相应地撤销支付，这一过程极具复杂性。这些机制必须万无一失，以防止被利用并确保系统的完整性，因此需要严格的测试和可能的反复迭代。

- **无许可性与抗审查性** 虽然 TBHL 旨在维持无许可的环境并抵抗审查，但在新框架内实现这些目标仍然面临挑战。确保任何构建者都可以提交出价，并确保提议者区块公平地代表竞争环境，需要对出价池的透明和安全处理。此外，在 TBHL 结构中集成前向包含列表或其他抗审查机制，需要额外的协议考量，以防止操控或排他性做法。

- **与现有和未来以太坊功能的兼容性** TBHL 必须与以太坊当前的协议功能无缝集成，并能够适应未来的创新，如单时隙最终性（SSF）和 MEV 烧毁机制。确保与这些发展中的以太坊生态系统方面的兼容性，要求设计和实施时具有前瞻性，能够容纳调整和增强，同时不破坏 TBHL 框架的完整性或效能。

- **资源与计算开销** TBHL 的引入带来了新的计算和资源开销，特别是涉及到处理双区块机制和额外确认回合的增加数据量。优化协议以高效管理这些需求，同时不显著增加验证者的计算负担或影响网络性能，是一项重要的工程问题。

TBHL 提案是对以太坊 PBS 机制不断完善的见证，力求在操作效率、安全性和去中心化的整体理念之间找到平衡。通过解决提议者和构建者之间的复杂动态，并引入强有力的保护措施，TBHL 标志着以太坊协议设计的一大进步，提供了一个有前景的途径，减轻了 MEV 带来的挑战，同时增强了网络的弹性和完整性。

你可以了解更多不同的 ePBS 解决方案，参阅 [PTC](/docs/wiki/research/PBS/PTC.md) 和 [PEPC](/docs/wiki/research/PBS/PEPC.md)。

## 资源
- [为什么要确立提议者-构建者分离？通向 ePBS 的可行路径](https://ethresear.ch/t/why-enshrine-proposer-builder-separation-a-viable-path-to-epbs/15710/1)
- [PBS](/docs/wiki/research/PBS/pbs.md)
- [ePBS](/docs/wiki/research/PBS/epbs.md)
- [Mike Neuder - 迈向确立的提议者-构建者分离](https://www.youtube.com/watch?v=Ub8V7lILb_Q)

## 参考文献
[^1]: https://ethresear.ch/t/why-enshrine-proposer-builder-separation-a-viable-path-to-epbs/15710/1
